package main;

import java.io.File;
import java.io.IOException;
import java.lang.reflect.InvocationTargetException;
import java.lang.reflect.Method;
import java.math.BigDecimal;
import java.util.ArrayList;
import java.util.List;

import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import javax.xml.parsers.ParserConfigurationException;

import org.w3c.dom.Document;
import org.w3c.dom.Element;
import org.w3c.dom.Node;
import org.w3c.dom.NodeList;
import org.xml.sax.SAXException;

public class Main2 {
	
	public int posicao = 100;
	
	public void gerarParametros(NodeList params, int initIndex, StringBuilder sb, Object vo) throws ClassNotFoundException, NoSuchMethodException, SecurityException, IllegalAccessException, IllegalArgumentException, InvocationTargetException, InstantiationException {
		for(int i = initIndex; i < params.getLength(); i++){
			Node node = params.item(i);
			if(node.getNodeType() == Node.ELEMENT_NODE){
				Element el = (Element)node;
				
				if(el.getTagName().equals("param")){
					
					String tamanho = el.getElementsByTagName("size").item(0).getTextContent();
					String classe = el.getElementsByTagName("class").item(0).getTextContent();
					String prop = el.getElementsByTagName("property").item(0).getTextContent();
					String decimal = el.getElementsByTagName("decimal").item(0).getTextContent();
					
					String valor = sb.substring(this.posicao, posicao += Integer.parseInt(tamanho));
					
					prop = "set" + prop.substring(0, 1).toUpperCase() + prop.substring(1);
					
					if(classe.equals("Numeric")){
						if(!decimal.equals("0")){
							BigDecimal bd = new BigDecimal(valor).setScale(Integer.parseInt(decimal));
							Main2.invocarMetodo(prop, vo, bd);
						}
						else{
							Main2.invocarMetodo(prop, vo, Long.parseLong(valor));
						}
					}
					else{
						Main2.invocarMetodo(prop, vo, valor);
					}
				}
				
				else if(el.getTagName().equals("loop")){
					
					Integer repetitions = Integer.parseInt(el.getElementsByTagName("repetitions").item(0).getTextContent());
					//Integer tamanho = Integer.parseInt(el.getElementsByTagName("size").item(0).getTextContent());
					String classe = el.getElementsByTagName("class").item(0).getTextContent();
					String prop = el.getElementsByTagName("property").item(0).getTextContent();
					String voLoop = el.getElementsByTagName("vo").item(0).getTextContent();
					
					prop = "set" + prop.substring(0, 1).toUpperCase() + prop.substring(1);
					List lista = new ArrayList();
						
					for(int j = 0; j < repetitions; j ++){
						Object obj = Main.instanciaObjeto(voLoop);
						this.gerarParametros(el.getChildNodes(),10,sb,obj);
						lista.add(obj);
					}
					Main2.invocarMetodo(prop, vo, lista);
				}
			}
		}
	}
	
	public static Object invocarMetodo(String metodo, Object obj, Object param) throws ClassNotFoundException, NoSuchMethodException, SecurityException, IllegalAccessException, IllegalArgumentException, InvocationTargetException{
		Method  method = obj.getClass().getMethod(metodo, param.getClass());
		return method.invoke(obj, param);
	}
	
	public static Object instanciaObjeto(String className) throws InstantiationException, IllegalAccessException, IllegalArgumentException, InvocationTargetException, NoSuchMethodException, SecurityException, ClassNotFoundException{
		return Class.forName(className).getConstructor().newInstance();
	}
	

	public static void main(String[] args) throws ParserConfigurationException, SAXException, IOException, ClassNotFoundException, NoSuchMethodException, SecurityException, IllegalAccessException, IllegalArgumentException, InvocationTargetException, InstantiationException {
		
		Pinctgf7VO pinctgf7vo = new Pinctgf7VO();
		
		DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
		DocumentBuilder builder = factory.newDocumentBuilder();
		Document doc = builder.parse(new File("D:/Programming/Java/CTGParser/src/"+pinctgf7vo.getXMLName()+".xml"));
		doc.getDocumentElement().normalize();
		
		StringBuilder sb = new StringBuilder("PINK025PRET OETS PRDRET OEAOTS 051111350013EC0AC8F0D9    13400               000                    000000000000000000000000000          0000000000000 0000                 00000000000 000 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000 000000000                                                 0000000    00000  0000000000000 0000000         00         00         00         00         00         00         00         00         00         00         00         00         000            00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000             00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000             00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000             00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000             00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000             00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000             00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000             00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000             00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000             00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000             00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000             00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000             00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000             00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000             00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000             00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000 00000000000000000000000000           00000000000                                 0000000000000000  000                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    00                                                                                                    ");
		
		Node nodeParams = doc.getElementsByTagName("parameters").item(0);
		NodeList params = nodeParams.getChildNodes();
		Main2 main = new Main2();
		main.gerarParametros(params, 0, sb, pinctgf7vo);
		
		System.out.println(pinctgf7vo.getCodCatServ());
		
		
		

	}

}
